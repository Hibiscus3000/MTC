import MTC/lab7/e2s;
import MTC/lab7/calc;
import string;

export
{
	algebraGrammar()  -> [PegOp];
}

algebraGrammarOp : ref Maybe<[PegOp]> = ref None();

algebraGrammar()
{
	onlyOnce(algebraGrammarOp, \ -> {
		compilePegGrammar("#include MTC/lab7/algebra_grammar.lingo");
	});
}

main()
{
	specialPegActions =
	{
		t = setTree(defaultPegActions.t, "buildSub", buildSub);
		SemanticActions(t);
	}	
	test = "-2 * 5 - (2   - f) * 4 + 5 -1";
	result = parsic(algebraGrammar(), test, specialPegActions);
	pairArr = [Pair("x","4 / 4"),Pair("f"," 21 / 14"),
		Pair("y","- 1   /   1"),Pair("Z","12")];
	println(test + " = " + e2sVariables(result,pairArr)
		+ " = " + r2s(calcVariables(result,pairArr),1));
	println(calcVariables(result,pairArr));
}